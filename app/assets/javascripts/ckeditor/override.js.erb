window['CKEDITOR_BASEPATH'] = "/assets/ckeditor/";

window.CKEDITOR_ASSETS_MAPPING = {
<% assets = Rails.application.assets || Sprockets::Railtie.build_environment(Rails.application) %>
<% prefix_length = Rails.root.join('app', 'assets').to_s.length %>
<% assets.each_file().select {|path| path =~ /ckeditor/ && path !~ /override\.js/ && path !~ /init\.js/ && path !~ /ckeditor\.js/ && path.index('ckeditor/filebrowser').nil? && path.index('.md').nil? && (path.index('.html').nil? || !path.index('.htmlm').nil?) && path.index('LICENSE').nil? && path.index('README').nil? }.each do |asset| %>
  <% f = asset[prefix_length..-1] %>
  <% f = f.split('/')[2..-1].join('/') %>
  "<%= f %>": "<%= asset_path(f) %>",
<% end %>
}

window.CKEDITOR_GETURL = function( resource ) {
  // If this is not a full or absolute path.
  if ( resource.indexOf( ':/' ) == -1 && resource.indexOf( '/' ) !== 0 )
    resource = this.basePath + resource;

  // Add the timestamp, except for directories.
  if ( resource.charAt( resource.length - 1 ) != '/'  ){
    var url = resource.match( /^(.*?:\/\/[^\/]*)\/assets\/(.+)/ );
    if(url) resource = (CKEDITOR_ASSETS_MAPPING[url[2]] || '/assets/' + url[2]);
  }

  return resource;
}
